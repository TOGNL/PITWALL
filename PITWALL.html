<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Tableau Pilote – Falcon Racing</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#000000" />
  <style>
    :root{
      --black:#000;
      --white:#fff;
      --yellow:#FFD500;
      --green:#00A651;
      --blue:#007BFF;
      --btn:#1f1f1f;
      --btnTxt:#fff;
      --accent:#888;
      --blink:0.8s; /* période unique pour synchroniser tous les clignotements */
    }

    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--black);color:var(--white)}

    /* Zone d'affichage plein écran */
    .display{position:fixed;inset:0;background:var(--black);display:flex;align-items:center;justify-content:center;overflow:hidden;z-index:1}
    .message{font-weight:900;text-transform:uppercase;text-align:center;letter-spacing:.04em;line-height:0.98;white-space:pre-line;
             font-size:36vmin; color:var(--white); padding:.05em .1em;}

    /* Etats de drapeaux (plein écran) */
    .bg-yellow{background:var(--yellow)}
    .bg-green{background:var(--green)}
    .bg-blue{background:var(--blue)}
    .bg-checkered{ /* vrai damier, carrés nets et proportionnels */
      --sq: min(16vmin, 18vh);
      background:
        conic-gradient(#000 25%, #fff 0 50%, #000 0 75%, #fff 0) 0 0 / var(--sq) var(--sq),
        conic-gradient(#fff 25%, #000 0 50%, #fff 0 75%, #000 0) calc(var(--sq)/2) calc(var(--sq)/2) / var(--sq) var(--sq);
    }

    /* Clignotements synchronisés (steps pour bascule franche, même période partout) */
    @keyframes blink {0%,49%{opacity:1}50%,100%{opacity:.18}}
    .blink{animation:blink var(--blink) steps(1,end) infinite}

    /* FCY: fond jaune/noir + texte noir/blanc (inversés) */
    @keyframes fcyBg { 0%,49% { background: var(--yellow); } 50%,100% { background: var(--black); } }
    @keyframes fcyText { 0%,49% { color: #000; } 50%,100% { color: #fff; } }
    .fcy { animation:fcyBg var(--blink) steps(1,end) infinite }
    .fcy-text { animation:fcyText var(--blink) steps(1,end) infinite }

    /* Inversion noir/blanc pour BOX BOX, FOCUS, Positions et 7000+ */
    @keyframes invertBg { 0%,49% { background: var(--black); } 50%,100% { background: var(--white); } }
    @keyframes invertText { 0%,49% { color: var(--white); } 50%,100% { color: var(--black); } }
    .invert { animation:invertBg var(--blink) steps(1,end) infinite }
    .invert-text { animation:invertText var(--blink) steps(1,end) infinite }

    /* DERNIER
TOUR : bleu/jaune alternés en inversé */
    @keyframes lastLapBg { 0%,49% { background: var(--blue); } 50%,100% { background: var(--yellow); } }
    @keyframes lastLapText { 0%,49% { color: var(--yellow); } 50%,100% { color: var(--blue); } }
    .lastlap { animation:lastLapBg var(--blink) steps(1,end) infinite }
    .lastlap-text { animation:lastLapText var(--blink) steps(1,end) infinite }

    /* Barre menu en bas */
    .bar{position:fixed;left:0;right:0;bottom:0;padding:calc(10px + env(safe-area-inset-bottom)) 10px 10px;display:flex;justify-content:center;z-index:1001;pointer-events:auto}
    .menu-toggle{appearance:none;border:0;border-radius:999px;background:var(--btn);color:var(--btnTxt);padding:14px 26px;font-size:1.1rem;font-weight:800}

    /* Menu horizontal */
    .menu{position:fixed;left:0;right:0;bottom:64px;display:flex;justify-content:center;flex-wrap:wrap;gap:8px;padding:10px;z-index:1000;transform:translateY(16px) scale(.98);opacity:0;pointer-events:none;transition:transform .2s ease, opacity .2s ease}
    .menu.open{transform:translateY(0);opacity:1;pointer-events:auto}
    .btn{appearance:none;border:0;border-radius:12px;background:var(--btn);color:var(--btnTxt);padding:12px 16px;min-width:110px;font-weight:800;text-transform:uppercase}
    .btn-green{background:var(--green)}
    .btn-yellow{background:var(--yellow);color:#111}
    .btn-blue{background:var(--blue)}
    .btn-check{background:linear-gradient(45deg,#fff 25%,#000 25%,#000 50%,#fff 50%,#fff 75%,#000 75%,#000 100%);color:#fff}
    .btn-outline{background:transparent;border:2px solid var(--accent);color:#ddd}

    /* Sous-menu position */
    .submenu{position:fixed;left:0;right:0;bottom:120px;display:flex;justify-content:center;z-index:999;transform:translateY(10px) scale(.98);opacity:0;pointer-events:none;transition:transform .2s ease, opacity .2s ease}
    .submenu.open{transform:translateY(0);opacity:1;pointer-events:auto}
    .scroller{display:flex;gap:8px;max-width:100vw;overflow:auto;padding:8px 10px}
    .pos{min-width:64px;padding:12px 14px;border-radius:10px;background:#222;color:#fff;font-weight:900}
  </style>
</head>
<body>
  <div class="display" id="display">
    <div class="message" id="message"></div>
  </div>

  <!-- Menu principal -->
  <div class="menu" id="menu">
    <button class="btn" data-action="position">Position</button>
    <button class="btn" data-action="box">BOX BOX</button>
    <button class="btn" data-action="rpm">7000+</button>
    <button class="btn" data-action="focus">FOCUS</button>
    <button class="btn btn-green" data-flag="green">Drapeau vert</button>
    <button class="btn btn-yellow" data-flag="yellow">Drapeau jaune</button>
    <button class="btn btn-check" data-flag="checkered">Damier</button>
    <button class="btn btn-yellow" data-action="fcy">FCY</button>
    <button class="btn" data-action="lastlap">Dernier tour</button>
    <button class="btn btn-blue" data-flag="blue">Bleu (clignote)</button>
    <button class="btn btn-outline" data-action="reset">Réinitialiser</button>
  </div>

  <!-- Sous-menu des positions -->
  <div class="submenu" id="submenu">
    <div class="scroller" id="posScroller"></div>
  </div>

  <div class="bar"><button class="menu-toggle" id="menuToggle">MENU</button></div>

<script>
  const display = document.getElementById('display');
  const message = document.getElementById('message');
  const menu = document.getElementById('menu');
  const submenu = document.getElementById('submenu');
  const toggle = document.getElementById('menuToggle');
  const posScroller = document.getElementById('posScroller');

  // ------- Sync des animations -------
  function restartAnimations(...els){
    els.forEach(el=> el.style.animation='none');
    // force reflow pour remettre l'horloge à zéro sur tous les éléments
    void document.body.offsetHeight;
    els.forEach(el=> el.style.animation='');
  }

  // ------- Helpers -------
  function openMenu(open){ menu.classList.toggle('open', open); if(!open) submenu.classList.remove('open'); }
  function openSub(open){ submenu.classList.toggle('open', open); }
  function clearFlags(){
    display.className = 'display';
    message.className = 'message';
    message.style.color='';
  }
  function clearMessage(){ message.textContent = ''; message.style.color=''; message.className = 'message'; }

  function showMessage(txt){
    message.textContent = txt;
    fitMessageSize();
  }

  // Ajuste la taille du texte pour qu'il occupe au max l'écran sans déborder
  function fitMessageSize(){
    if(!message.textContent) return;
    const maxW = window.innerWidth * 0.98;
    const maxH = window.innerHeight * 0.95;
    let lo = 8, hi = 110; // vmin
    while(lo <= hi){
      const mid = Math.floor((lo+hi)/2);
      message.style.fontSize = mid + 'vmin';
      const tooBig = message.scrollWidth > maxW || message.scrollHeight > maxH;
      if(tooBig) hi = mid - 1; else lo = mid + 1;
    }
    message.style.fontSize = hi + 'vmin';
  }
  window.addEventListener('resize', ()=>{ if(message.textContent) fitMessageSize(); });

  // Génère P1..P30
  for(let i=1;i<=30;i++){
    const b = document.createElement('button');
    b.className = 'pos'; b.textContent = i;
    b.addEventListener('click', ()=>{
      clearFlags();
      display.classList.add('invert');
      message.classList.add('invert-text');
      showMessage('P'+i);
      restartAnimations(display, message);
      openMenu(false); openSub(false);
    });
    posScroller.appendChild(b);
  }

  // Bouton MENU – pointer-friendly, sans doublons
  let toggling = false;
  function safeToggle(){
    if (toggling) return;
    toggling = true;
    openMenu(!menu.classList.contains('open'));
    setTimeout(()=>{ toggling = false; }, 150);
  }
  // Support universel : pointer + click (fallback anciens navigateurs)
  toggle.addEventListener('pointerup', (e)=>{ e.preventDefault(); safeToggle(); });
  toggle.addEventListener('click', (e)=>{ e.preventDefault(); safeToggle(); });
  // Accès clavier (Enter/Espace)
  toggle.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); safeToggle(); }
  });

  // Actions du menu
  menu.addEventListener('click', (e)=>{
    const btn = e.target.closest('button'); if(!btn) return;
    const action = btn.dataset.action; const flag = btn.dataset.flag;

    if(action === 'position'){ openSub(!submenu.classList.contains('open')); return; }
    if(action === 'box'){
      clearFlags();
      display.classList.add('invert');
      message.classList.add('invert-text');
      showMessage('BOX BOX');
      restartAnimations(display, message);
      openMenu(false); return;
    }
    if(action === 'rpm'){
      clearFlags();
      display.classList.add('invert');
      message.classList.add('invert-text');
      showMessage('7000+');
      restartAnimations(display, message);
      openMenu(false); return;
    }
    if(action === 'focus'){
      clearFlags();
      display.classList.add('invert');
      message.classList.add('invert-text');
      showMessage('FOCUS');
      restartAnimations(display, message);
      openMenu(false); return;
    }
    if(action === 'fcy'){
      clearFlags();
      display.classList.add('fcy'); // fond jaune/noir
      message.classList.add('fcy-text'); // texte noir/blanc
      showMessage('FCY');
      restartAnimations(display, message);
      openMenu(false); return;
    }
    if(action === 'lastlap'){
      clearFlags();
      display.classList.add('lastlap'); // fond bleu/jaune
      message.classList.add('lastlap-text'); // texte inverse
      showMessage('DERNIER TOUR');
      restartAnimations(display, message);
      openMenu(false); return;
    }
    if(action === 'reset'){ clearFlags(); clearMessage(); openMenu(false); return; }

    if(flag){
      clearFlags(); clearMessage();
      if(flag==='green') display.classList.add('bg-green');
      else if(flag==='yellow') display.classList.add('bg-yellow');
      else if(flag==='checkered') display.classList.add('bg-checkered');
      else if(flag==='blue') { display.classList.add('bg-blue','blink'); restartAnimations(display); }
      openMenu(false);
    }
  });

  // Tap sur l'écran pour tout remettre noir
  display.addEventListener('click', ()=>{ clearFlags(); clearMessage(); });

  // Empêche le zoom double-tap iOS
  let lastTouch = 0;
  
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Tableau Pilote ‚Äì Falcon Racing</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#000000" />
  <style>
    :root{
      --black:#000; --white:#fff;
      --yellow:#FFD500; --yellow-dark:#000000;
      --green:#00A651; --blue:#007BFF;

      --btn:#1f1f1f; --btnTxt:#fff; --accent:#888;

      --blink:0.6s;     /* p√©riode globale pour certaines anims */
      --gblink:0.55s;   /* vert rapide */
      --yblink:0.45s;   /* jaune plus rapide */

      /* Filigrane */
      --wmColor:#333333;
      --wmOpacity:.60;
    }

    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#000;color:#fff;user-select:none}

    .display{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;overflow:hidden;background:var(--black);z-index:1}
    .message{
  position:relative;
  z-index:2;
  display:flex;                /* ajout flex */
  align-items:center;          /* centre vertical */
  justify-content:center;      /* centre horizontal */
  font-weight:900;
  text-transform:uppercase;
  text-align:center;
  letter-spacing:.04em;
  line-height:0;
  white-space:pre-line;
  font-size:80vmin;
  color:var(--white);
  padding:.05em .1em;
}

    /* Filigrane */
    .watermark{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none;z-index:0}
    .watermark span{
      font-weight:900;text-transform:uppercase;letter-spacing:.12em;
      color:var(--wmColor);opacity:var(--wmOpacity);
      white-space:pre-line;text-align:center;line-height:.85;
      font-size:clamp(3rem,18vw,22rem);
      -webkit-text-stroke:1px rgba(255,255,255,.10);
      text-shadow:0 0 6px rgba(255,255,255,.08);
    }

    /* Damier */
    .bg-checkered{
      --sq:min(16vmin,18vh);
      background:
        conic-gradient(#000 25%, #fff 0 50%, #000 0 75%, #fff 0) 0 0 / var(--sq) var(--sq),
        conic-gradient(#fff 25%, #000 0 50%, #fff 0 75%, #000 0) calc(var(--sq)/2) calc(var(--sq)/2) / var(--sq) var(--sq);
    }

    /* Inversions / Clignotements */
    @keyframes invertBg {0%,49%{background:var(--black)}50%,100%{background:var(--white)}}
    @keyframes invertText {0%,49%{color:var(--white)}50%,100%{color:var(--black)}}
    .invert{animation:invertBg var(--blink) steps(1,end) infinite}
    .invert-text{animation:invertText var(--blink) steps(1,end) infinite}

    /* FCY */
    @keyframes fcyBg {0%,49%{background:var(--yellow)}50%,100%{background:var(--black)}}
    @keyframes fcyText {0%,49%{color:#000}50%,100%{color:#fff}}
    .fcy{animation:fcyBg var(--blink) steps(1,end) infinite}
    .fcy-text{animation:fcyText var(--blink) steps(1,end) infinite}

    /* Vert / Bleu */
    @keyframes greenBg {0%,49%{background:var(--green)}50%,100%{background:var(--black)}}
    .green-flash{animation:greenBg var(--gblink) steps(1,end) infinite}
    @keyframes blueBg {0%,49%{background:var(--blue)}50%,100%{background:var(--black)}}
    .blue-flash{animation:blueBg var(--blink) steps(1,end) infinite}

    /* Jaune (diagonale unique) */
    @keyframes yellowSwap {
      0%,49%  { background:linear-gradient(to top right, var(--yellow) 0 50%, var(--yellow-dark) 50% 100%); }
      50%,100%{ background:linear-gradient(to top right, var(--yellow-dark) 0 50%, var(--yellow) 50% 100%); }
    }
    .yellow-swap{animation:yellowSwap var(--yblink) steps(1,end) infinite}

    /* LAST LAP */
    @keyframes lastBg {0%,49%{background:var(--blue)}50%,100%{background:var(--yellow)}}
    @keyframes lastTxt{0%,49%{color:var(--yellow)}50%,100%{color:var(--blue)}}
    .lastlap{animation:lastBg var(--blink) steps(1,end) infinite}
    .lastlap-text{animation:lastTxt var(--blink) steps(1,end) infinite}

    /* Clignotement du chiffre (vert -> noir) avec vitesse r√©glable dynamiquement */
    @keyframes countFlash {
      0%,49%{ color: var(--green); }
      50%,100%{ color: #000; } /* noir sur fond noir = invisible */
    }

    /* Barre / Menu */
    .bar{position:fixed;left:0;right:0;bottom:0;padding:calc(10px + env(safe-area-inset-bottom)) 10px 10px;display:flex;justify-content:center;z-index:5001}
    .menu-toggle{appearance:none;border:0;border-radius:999px;background:var(--btn);color:var(--btnTxt);padding:clamp(12px,1.8vh,18px) clamp(20px,4vw,28px);font-size:clamp(16px,3.5vw,22px);font-weight:800}

    .menu{position:fixed;left:0;right:0;bottom:64px;display:flex;justify-content:center;flex-wrap:wrap;gap:8px;padding:10px;z-index:5000;transform:translateY(16px) scale(.98);opacity:0;pointer-events:none;transition:transform .2s ease, opacity .2s ease}
    .menu.open{transform:translateY(0);opacity:1;pointer-events:auto}
    .btn{appearance:none;border:0;border-radius:12px;background:var(--btn);color:var(--btnTxt);padding:clamp(10px,1.6vh,16px) clamp(14px,2vw,22px);min-width:clamp(88px,22vw,160px);font-weight:800;text-transform:uppercase;font-size:clamp(14px,2.8vw,22px)}
    .btn-green{background:var(--green)}
    .btn-yellow{background:var(--yellow);color:#111}
    .btn-blue{background:var(--blue)}
    .btn-check{background:linear-gradient(45deg,#fff 25%, #000 25%, #000 50%, #fff 50%, #fff 75%, #000 75%, #000 100%); color:#fff}
    .btn-outline{background:transparent; border:2px solid var(--accent); color:#ddd}

    /* Modals (Position & Penalty) */
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.7);z-index:6000;opacity:0;pointer-events:none;transition:opacity .2s ease}
    .modal.open{opacity:1;pointer-events:auto}
    .sheet{background:#111;border:2px solid #333;border-radius:16px;padding:16px;max-width:min(95vw,700px);width:95vw}
    .sheet h3{margin:0 0 10px 0;font-size:clamp(16px,4vw,22px);text-align:center;letter-spacing:.06em}
    .grid-nums{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:10px}
    .num,.chip{background:#222;color:#fff;border:2px solid #333;border-radius:12px;padding:clamp(10px,2.2vh,18px);font-weight:900;font-size:clamp(18px,4.5vw,28px);text-align:center}
    .row-title{margin:8px 0 6px;font-weight:800;letter-spacing:.06em;text-align:center;color:#ddd}
    .close-row{display:flex;justify-content:center;margin-top:12px}
    .close{background:#1f1f1f;color:#fff;border:2px solid #444;border-radius:999px;padding:8px 18px;font-weight:800}

/* METEO */
.border-flash-sun{animation:borderFlashSun 0.8s infinite alternate;}
.border-flash-cloud{animation:borderFlashCloud 0.8s infinite alternate;}
.border-flash-rain-slow{animation:borderFlashRain 1.2s infinite alternate;}
.border-flash-rain-fast{animation:borderFlashRain 0.4s infinite alternate;}

@keyframes borderFlashSun{
  from{box-shadow:inset 0 0 0 20px transparent;}
  to{box-shadow:inset 0 0 0 50px var(--yellow);}
}
@keyframes borderFlashCloud{
  from{box-shadow:inset 0 0 0 20px transparent;}
  to{box-shadow:inset 0 0 0 50px gray;}
}
@keyframes borderFlashRain{
  from{box-shadow:inset 0 0 0 20px transparent;}
  to{box-shadow:inset 0 0 0 50px var(--blue);}
}


  </style>
</head>
<body>
  <div class="display" id="display">
    <div class="watermark" id="watermark"><span>GUISNEL
RACING TEAM</span></div>
    <div class="message" id="message"></div>
  </div>


  <div class="menu" id="menu">
    <button class="btn" data-action="position">Position</button>
    <button class="btn" data-action="box">BOX</button>
    <button class="btn" data-action="rpm">7000+</button>
    <button class="btn" data-action="focus">FOCUS</button>
    <button class="btn" data-action="pit">PIT</button>
    <button class="btn" data-action="lastlap">Dernier tour</button>
    <button class="btn btn-check" data-flag="checkered">Damier</button>
    <button class="btn" data-action="penalty">Penalty</button>
    <button class="btn" data-action="meteo">METEO</button>
    <button class="btn btn-blue" data-flag="blue">Drapeau Bleu</button>
    <button class="btn btn-green" data-flag="green">Drapeau vert</button>
    <button class="btn btn-yellow" data-flag="yellow">Drapeau jaune</button>
    <button class="btn btn-yellow" data-action="fcy">FCY</button>
    <button class="btn btn-outline" data-action="reset">R√©initialiser</button>
  </div>

  <!-- MODAL Position -->
  <div class="modal" id="posModal">
    <div class="sheet" role="dialog" aria-modal="true">
      <h3>Choisir la position</h3>
      <div class="grid-nums" id="posGrid"></div>
      <div class="close-row"><button class="close" id="posClose">Fermer</button></div>
    </div>
  </div>

  <!-- MODAL Penalty -->
  <div class="modal" id="penModal">
    <div class="sheet" role="dialog" aria-modal="true">
      <h3>S√©lectionner une p√©nalit√©</h3>
      <div class="row-title">Temps</div>
      <div class="grid-nums" id="penGridTime"></div>
      <div class="row-title">Tours</div>
      <div class="grid-nums" id="penGridLap"></div>
      <div class="close-row"><button class="close" id="penClose">Fermer</button></div>
    </div>
  </div>

  <!-- MODAL METEO -->
<div class="modal" id="meteoModal">
  <div class="sheet">
    <h3>M√©t√©o</h3>
    <button class="btn" data-weather="sun">‚òÄÔ∏è Soleil</button>
    <button class="btn" data-weather="cloud">‚òÅÔ∏è Nuages</button>
    <button class="btn" data-weather="rain-light">üå¶Ô∏è Faible pluie</button>
    <button class="btn" data-weather="rain-heavy">üåßÔ∏è Forte pluie</button>
    <div class="close-row"><button class="close" id="meteoClose">Fermer</button></div>
  </div>
</div>


  <div class="bar"><button class="menu-toggle" id="menuToggle">MENU</button></div>

<script>
  const display   = document.getElementById('display');
  const message   = document.getElementById('message');
  const watermark = document.getElementById('watermark');
  const menu      = document.getElementById('menu');
  const toggle    = document.getElementById('menuToggle');

  const posModal  = document.getElementById('posModal');
  const posGrid   = document.getElementById('posGrid');
  const posClose  = document.getElementById('posClose');

  const penModal    = document.getElementById('penModal');
  const penGridTime = document.getElementById('penGridTime');
  const penGridLap  = document.getElementById('penGridLap');
  const penClose    = document.getElementById('penClose');

  /* Helpers */
  function restartAnimations(...els){ els.forEach(el=> el.style.animation='none'); void document.body.offsetHeight; els.forEach(el=> el.style.animation=''); }
  function openMenu(open){ menu.classList.toggle('open', open); }
  function hideWatermark(){ if(watermark) watermark.style.display='none'; }
  function showWatermark(){ if(watermark) watermark.style.display='flex'; }
  function clearFlags(){ display.className='display'; message.className='message'; message.style.color=''; display.style.animation=''; message.style.animation=''; }
  function clearMessage(){ message.textContent=''; message.style.color=''; message.className='message'; }
  function showMessage(txt){ message.textContent=txt; fitMessageSize(); }

  function fitMessageSize(){
    if(!message.textContent) return;
    const maxW=window.innerWidth*0.98, maxH=window.innerHeight*0.95;
    let lo=8, hi=110;
    while(lo<=hi){
      const mid=(lo+hi>>1);
      message.style.fontSize=mid+'vmin';
      const big=message.scrollWidth>maxW || message.scrollHeight>maxH;
      if(big) hi=mid-1; else lo=mid+1;
    }
    message.style.fontSize=hi+'vmin';
  }
  window.addEventListener('resize', ()=>{ if(message.textContent) fitMessageSize(); });

  /* POSITION modal */
  function openPosModal(){ hideWatermark(); openMenu(false); posModal.classList.add('open'); }
  function closePosModal(){ posModal.classList.remove('open'); }
  for(let i=1;i<=30;i++){
    const b=document.createElement('button');
    b.className='num'; b.textContent=i;
    b.addEventListener('click',()=>{
      clearPit(); // au cas o√π
      clearFlags();
      display.classList.add('invert');
      message.classList.add('invert-text');
      showMessage('P'+i);
      restartAnimations(display, message);
      closePosModal();
    });
    posGrid.appendChild(b);
  }
  posClose.addEventListener('click', closePosModal);
  posModal.addEventListener('click', e=>{ if(e.target===posModal) closePosModal(); });

  /* PENALTY modal */
  function openPenModal(){ hideWatermark(); openMenu(false); penModal.classList.add('open'); }
  function closePenModal(){ penModal.classList.remove('open'); }

/* METEO modal */
const meteoModal=document.getElementById('meteoModal');
const meteoClose=document.getElementById('meteoClose');

menu.addEventListener('click',e=>{
  if(e.target.dataset.action==="meteo"){
    hideWatermark();
    openMenu(false);
    meteoModal.classList.add('open');
  }
});

meteoModal.addEventListener('click',e=>{
  if(e.target.dataset.weather){
    clearFlags();
    clearMessage();
    display.className='display';
  

    if(e.target.dataset.weather==="sun"){
      message.textContent="‚òÄÔ∏è";
      display.classList.add('border-flash-sun');
    }
    if(e.target.dataset.weather==="cloud"){
      message.textContent="‚òÅÔ∏è";
      display.classList.add('border-flash-cloud');
    }
    if(e.target.dataset.weather==="rain-light"){
      message.textContent="üå¶Ô∏è";
      display.classList.add('border-flash-rain-slow');
    }
    if(e.target.dataset.weather==="rain-heavy"){
      message.textContent="üåßÔ∏è";
      display.classList.add('border-flash-rain-fast');
    }

    meteoModal.classList.remove('open');
  }
});

meteoClose.addEventListener('click',()=>meteoModal.classList.remove('open'));

  // Temps : secondes (sec.) et minutes (min)
  const seconds = [5,10,15,20,30];
  seconds.forEach(val=>{
    const label = `${val}sec.`;  
    const b=document.createElement('button');
    b.className='chip'; b.textContent=label;
    b.addEventListener('click', ()=>{
      clearPit();
      clearFlags();
      display.classList.add('invert'); message.classList.add('invert-text');
      showMessage(`+${label}\nPENALTY`);
      restartAnimations(display, message);
      closePenModal();
    });
    penGridTime.appendChild(b);
  });
  {
    const b=document.createElement('button');
    b.className='chip'; b.textContent='1min';
    b.addEventListener('click', ()=>{
      clearPit();
      clearFlags();
      display.classList.add('invert'); message.classList.add('invert-text');
      showMessage(`+1min\nPENALTY`);
      restartAnimations(display, message);
      closePenModal();
    });
    penGridTime.appendChild(b);
  }

  // Tours
  for(let laps=1;laps<=5;laps++){
    const b=document.createElement('button');
    b.className='chip';
    b.textContent = laps === 1 ? '1 LAP' : `${laps} LAPS`;
    b.addEventListener('click', ()=>{
      clearPit();
      clearFlags();
      display.classList.add('invert'); message.classList.add('invert-text');
      const unit = laps > 1 ? 'LAPS' : 'LAP';
      showMessage(`+ ${laps} ${unit}\nPENALTY`);
      restartAnimations(display, message);
      closePenModal();
    });
    penGridLap.appendChild(b);
  }

  penClose.addEventListener('click', closePenModal);
  penModal.addEventListener('click', e=>{ if(e.target===penModal) closePenModal(); });

  /* MENU */
  document.getElementById('menuToggle').addEventListener('click', e=>{
    e.preventDefault(); openMenu(!menu.classList.contains('open'));
  });

  menu.addEventListener('click', (e)=>{
    const btn=e.target.closest('button'); if(!btn) return;
    const action=btn.dataset.action; const flag=btn.dataset.flag;

    if(action==='position'){ openPosModal(); return; }
    if(action==='penalty'){ openPenModal(); return; }
    hideWatermark();

    if(action==='box'){ clearPit(); clearFlags(); display.classList.add('invert'); message.classList.add('invert-text'); showMessage('BOX'); restartAnimations(display, message); openMenu(false); return; }
    if(action==='rpm'){ clearPit(); clearFlags(); display.classList.add('invert'); message.classList.add('invert-text'); showMessage('7000+'); restartAnimations(display, message); openMenu(false); return; }
    if(action==='focus'){ clearPit(); clearFlags(); display.classList.add('invert'); message.classList.add('invert-text'); showMessage('FOCUS'); restartAnimations(display, message); openMenu(false); return; }
    if(action==='fcy'){ clearPit(); clearFlags(); display.classList.add('fcy'); message.classList.add('fcy-text'); showMessage('FCY'); restartAnimations(display, message); openMenu(false); return; }
    if(action==='lastlap'){ clearPit(); clearFlags(); display.classList.add('lastlap'); message.classList.add('lastlap-text'); showMessage("LAST\nLAP"); restartAnimations(display, message); openMenu(false); return; }
    if(action==='reset'){ resetToWatermark(); openMenu(false); return; }

    if(action==='pit'){ startPitCountdown(); openMenu(false); return; }

    if(flag){
      clearPit();
      clearFlags(); clearMessage();
      if(flag==='green') display.classList.add('green-flash');
      else if(flag==='yellow') display.classList.add('yellow-swap');
      else if(flag==='checkered') display.classList.add('bg-checkered');
      else if(flag==='blue') display.classList.add('blue-flash');
      restartAnimations(display);
      openMenu(false);
    }
  });

  /* === PIT Countdown === */
  let pitInterval=null;
  let pitActive=false;

  function clearPit(){
    if(pitInterval){ clearInterval(pitInterval); pitInterval=null; }
    pitActive=false;
    message.style.animation='';
    display.style.animation='';
  }

  function resetToWatermark(){
    clearPit();
    showWatermark();
    clearFlags();
    clearMessage();
  }

  function startPitCountdown(){
    clearPit();
    pitActive=true;
    hideWatermark();
    clearFlags();

    let time=150;               // compteur en secondes
    let beReadyStart=null;      // valeur de time quand BE READY d√©marre
    let beReadyEnd=null;        // valeur de time quand BE READY doit s'arr√™ter (15 s apr√®s le d√©but)

    function render(){
      clearFlags(); // enl√®ve classes/clignotements ant√©rieurs

      // D√©marrage de BE READY quand on passe sous 50s
      if(time <= 50 && beReadyStart === null){
        beReadyStart = time;
        beReadyEnd   = time - 15; // s'arr√™te 15s plus tard (time a diminu√©)
      }

      // Phase BE READY (affich√©e tant que time > beReadyEnd)
      if(beReadyStart !== null && time > beReadyEnd){
        message.textContent = "BE READY";
        message.style.color = "yellow";
        message.style.fontSize = "28vmin";
        // Le chrono continue en arri√®re-plan, donc on NE montre PAS le nombre ici
      } else if (time > 0){
        // Affichage du nombre g√©ant (sans "s")
        message.textContent = time;
        message.style.color = "white";
        fitMessageSize();
      }

      // Derni√®res 5 secondes : chiffre vert qui clignote vert/noir, de plus en plus vite
      if(time <= 5 && time > 0){
        message.textContent = time;         // s'assurer que le nombre est visible
        fitMessageSize();
        // vitesse : plus on approche de 0, plus c'est rapide
        const step = 5 - time;              // 0..4
        const speed = Math.max(0.15, 0.6 - step*0.1); // 0.6s -> 0.2s
        message.style.animation = `countFlash ${speed}s steps(1,end) infinite`;
      } else {
        // hors derni√®re 5 secondes : pas d'animation texte
        message.style.animation = '';
      }

      // Fin : 0 -> GO
      if(time === 0){
        clearPit();
        message.textContent = "GO";
        message.style.color = "lime";
        fitMessageSize();
        setTimeout(resetToWatermark, 1200);
      }

      time--;
    }

    render();
    pitInterval = setInterval(()=>{
      if(!pitActive){ clearPit(); return; }
      render();
    }, 1000);
  }

  /* Tap √©cran : retour watermark √† tout moment */
  display.addEventListener('click', resetToWatermark);
</script>
</body>
</html>

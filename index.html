<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>GUISNEL Racing PITWALL</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#000000" />
  <style>
    :root{
      --black:#000; --white:#fff;
      --yellow:#FFD500; --yellow-dark:#000000;
      --green:#00A651; --blue:#007BFF;

      --btn:#1f1f1f; --btnTxt:#fff; --accent:#888;

      --blink:0.8s;     /* période globale */
      --gblink:0.55s;   /* vert rapide */
      --yblink:0.45s;   /* jaune plus rapide */

      /* Filigrane */
      --wmColor:#333333;
      --wmOpacity:.60;
    }

    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#000;color:#fff;user-select:none}

    .display{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;overflow:hidden;background:var(--black);z-index:1}
    .message{position:relative;z-index:2;font-weight:900;text-transform:uppercase;text-align:center;letter-spacing:.04em;line-height:0.98;white-space:pre-line;font-size:36vmin;color:var(--white);padding:.05em .1em}

    /* Filigrane */
    .watermark{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none;z-index:0}
    .watermark span{
      font-weight:900;text-transform:uppercase;letter-spacing:.12em;
      color:var(--wmColor);opacity:var(--wmOpacity);
      white-space:pre-line;text-align:center;line-height:.85;
      font-size:clamp(3rem,18vw,22rem);
      -webkit-text-stroke:1px rgba(255,255,255,.10);
      text-shadow:0 0 6px rgba(255,255,255,.08);
    }

    /* Damier */
    .bg-checkered{
      --sq:min(16vmin,18vh);
      background:
        conic-gradient(#000 25%, #fff 0 50%, #000 0 75%, #fff 0) 0 0 / var(--sq) var(--sq),
        conic-gradient(#fff 25%, #000 0 50%, #fff 0 75%, #000 0) calc(var(--sq)/2) calc(var(--sq)/2) / var(--sq) var(--sq);
    }

    /* Inversions / Clignotements */
    @keyframes invertBg {0%,49%{background:var(--black)}50%,100%{background:var(--white)}}
    @keyframes invertText {0%,49%{color:var(--white)}50%,100%{color:var(--black)}}
    .invert{animation:invertBg var(--blink) steps(1,end) infinite}
    .invert-text{animation:invertText var(--blink) steps(1,end) infinite}

    /* FCY */
    @keyframes fcyBg {0%,49%{background:var(--yellow)}50%,100%{background:var(--black)}}
    @keyframes fcyText {0%,49%{color:#000}50%,100%{color:#fff}}
    .fcy{animation:fcyBg var(--blink) steps(1,end) infinite}
    .fcy-text{animation:fcyText var(--blink) steps(1,end) infinite}

    /* Vert / Bleu */
    @keyframes greenBg {0%,49%{background:var(--green)}50%,100%{background:var(--black)}}
    .green-flash{animation:greenBg var(--gblink) steps(1,end) infinite}
    @keyframes blueBg {0%,49%{background:var(--blue)}50%,100%{background:var(--black)}}
    .blue-flash{animation:blueBg var(--blink) steps(1,end) infinite}

    /* Jaune (diagonale unique) */
    @keyframes yellowSwap {
      0%,49%  { background:linear-gradient(to top right, var(--yellow) 0 50%, var(--yellow-dark) 50% 100%); }
      50%,100%{ background:linear-gradient(to top right, var(--yellow-dark) 0 50%, var(--yellow) 50% 100%); }
    }
    .yellow-swap{animation:yellowSwap var(--yblink) steps(1,end) infinite}

    /* LAST LAP */
    @keyframes lastBg {0%,49%{background:var(--blue)}50%,100%{background:var(--yellow)}}
    @keyframes lastTxt{0%,49%{color:var(--yellow)}50%,100%{color:var(--blue)}}
    .lastlap{animation:lastBg var(--blink) steps(1,end) infinite}
    .lastlap-text{animation:lastTxt var(--blink) steps(1,end) infinite}

    /* Barre / Menu */
    .bar{position:fixed;left:0;right:0;bottom:0;padding:calc(10px + env(safe-area-inset-bottom)) 10px 10px;display:flex;justify-content:center;z-index:5001}
    .menu-toggle{appearance:none;border:0;border-radius:999px;background:var(--btn);color:var(--btnTxt);padding:clamp(12px,1.8vh,18px) clamp(20px,4vw,28px);font-size:clamp(16px,3.5vw,22px);font-weight:800}

    .menu{position:fixed;left:0;right:0;bottom:64px;display:flex;justify-content:center;flex-wrap:wrap;gap:8px;padding:10px;z-index:5000;transform:translateY(16px) scale(.98);opacity:0;pointer-events:none;transition:transform .2s ease, opacity .2s ease}
    .menu.open{transform:translateY(0);opacity:1;pointer-events:auto}
    .btn{appearance:none;border:0;border-radius:12px;background:var(--btn);color:var(--btnTxt);padding:clamp(10px,1.6vh,16px) clamp(14px,2vw,22px);min-width:clamp(88px,22vw,160px);font-weight:800;text-transform:uppercase;font-size:clamp(14px,2.8vw,22px)}
    .btn-green{background:var(--green)}
    .btn-yellow{background:var(--yellow);color:#111}
    .btn-blue{background:var(--blue)}
    .btn-check{background:linear-gradient(45deg,#fff 25%, #000 25%, #000 50%, #fff 50%, #fff 75%, #000 75%, #000 100%); color:#fff}
    .btn-outline{background:transparent; border:2px solid var(--accent); color:#ddd}

    /* Modals (Position & Penalty) */
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.7);z-index:6000;opacity:0;pointer-events:none;transition:opacity .2s ease}
    .modal.open{opacity:1;pointer-events:auto}
    .sheet{background:#111;border:2px solid #333;border-radius:16px;padding:16px;max-width:min(95vw,700px);width:95vw}
    .sheet h3{margin:0 0 10px 0;font-size:clamp(16px,4vw,22px);text-align:center;letter-spacing:.06em}
    .grid-nums{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:10px}
    .num,.chip{background:#222;color:#fff;border:2px solid #333;border-radius:12px;padding:clamp(10px,2.2vh,18px);font-weight:900;font-size:clamp(18px,4.5vw,28px);text-align:center}
    .row-title{margin:8px 0 6px;font-weight:800;letter-spacing:.06em;text-align:center;color:#ddd}
    .close-row{display:flex;justify-content:center;margin-top:12px}
    .close{background:#1f1f1f;color:#fff;border:2px solid #444;border-radius:999px;padding:8px 18px;font-weight:800}
  </style>
</head>
<body>
  <div class="display" id="display">
    <div class="watermark" id="watermark"><span>GUISNEL
RACING</span></div>
    <div class="message" id="message"></div>
  </div>

  <!-- Menu principal -->
  <div class="menu" id="menu">
    <button class="btn" data-action="position">Position</button>
    <button class="btn" data-action="penalty">Penalty</button>
    <button class="btn" data-action="box">BOX BOX</button>
    <button class="btn" data-action="rpm">7000+</button>
    <button class="btn" data-action="focus">FOCUS</button>
    <button class="btn btn-green" data-flag="green">Drapeau vert</button>
    <button class="btn btn-yellow" data-flag="yellow">Drapeau jaune</button>
    <button class="btn btn-check" data-flag="checkered">Damier</button>
    <button class="btn btn-yellow" data-action="fcy">FCY</button>
    <button class="btn" data-action="lastlap">Dernier tour</button>
    <button class="btn btn-blue" data-flag="blue">Bleu (clignote)</button>
    <button class="btn btn-outline" data-action="reset">Réinitialiser</button>
  </div>

  <!-- MODAL Position -->
  <div class="modal" id="posModal">
    <div class="sheet" role="dialog" aria-modal="true">
      <h3>Choisir la position</h3>
      <div class="grid-nums" id="posGrid"></div>
      <div class="close-row"><button class="close" id="posClose">Fermer</button></div>
    </div>
  </div>

  <!-- MODAL Penalty -->
  <div class="modal" id="penModal">
    <div class="sheet" role="dialog" aria-modal="true">
      <h3>Sélectionner une pénalité</h3>
      <div class="row-title">Temps</div>
      <div class="grid-nums" id="penGridTime"></div>
      <div class="row-title">Tours</div>
      <div class="grid-nums" id="penGridLap"></div>
      <div class="close-row"><button class="close" id="penClose">Fermer</button></div>
    </div>
  </div>

  <div class="bar"><button class="menu-toggle" id="menuToggle">MENU</button></div>

<script>
  const display   = document.getElementById('display');
  const message   = document.getElementById('message');
  const watermark = document.getElementById('watermark');
  const menu      = document.getElementById('menu');
  const toggle    = document.getElementById('menuToggle');

  const posModal  = document.getElementById('posModal');
  const posGrid   = document.getElementById('posGrid');
  const posClose  = document.getElementById('posClose');

  const penModal    = document.getElementById('penModal');
  const penGridTime = document.getElementById('penGridTime');
  const penGridLap  = document.getElementById('penGridLap');
  const penClose    = document.getElementById('penClose');

  function restartAnimations(...els){ els.forEach(el=> el.style.animation='none'); void document.body.offsetHeight; els.forEach(el=> el.style.animation=''); }
  function openMenu(open){ menu.classList.toggle('open', open); }
  function hideWatermark(){ if(watermark) watermark.style.display='none'; }
  function showWatermark(){ if(watermark) watermark.style.display='flex'; }
  function clearFlags(){ display.className='display'; message.className='message'; message.style.color=''; }
  function clearMessage(){ message.textContent=''; message.style.color=''; message.className='message'; }
  function showMessage(txt){ message.textContent=txt; fitMessageSize(); }

  function fitMessageSize(){
    if(!message.textContent) return;
    const maxW=window.innerWidth*0.98, maxH=window.innerHeight*0.95;
    let lo=8, hi=110;
    while(lo<=hi){
      const mid=(lo+hi>>1);
      message.style.fontSize=mid+'vmin';
      const big=message.scrollWidth>maxW || message.scrollHeight>maxH;
      if(big) hi=mid-1; else lo=mid+1;
    }
    message.style.fontSize=hi+'vmin';
  }
  window.addEventListener('resize', ()=>{ if(message.textContent) fitMessageSize(); });

  /* POSITION modal */
  function openPosModal(){ hideWatermark(); openMenu(false); posModal.classList.add('open'); }
  function closePosModal(){ posModal.classList.remove('open'); }
  for(let i=1;i<=30;i++){
    const b=document.createElement('button');
    b.className='num'; b.textContent=i;
    b.addEventListener('click',()=>{
      clearFlags();
      display.classList.add('invert');
      message.classList.add('invert-text');
      showMessage('P'+i);
      restartAnimations(display, message);
      closePosModal();
    });
    posGrid.appendChild(b);
  }
  posClose.addEventListener('click', closePosModal);
  posModal.addEventListener('click', e=>{ if(e.target===posModal) closePosModal(); });

  /* PENALTY modal */
  function openPenModal(){ hideWatermark(); openMenu(false); penModal.classList.add('open'); }
  function closePenModal(){ penModal.classList.remove('open'); }

  // Temps : secondes (sec.) et minutes (min)
  const seconds = [5,10,15,20,30];
  seconds.forEach(val=>{
    const label = `${val}sec.`;   // ← remplace 's' par 'sec.'
    const b=document.createElement('button');
    b.className='chip'; b.textContent=label;
    b.addEventListener('click', ()=>{
      clearFlags();
      display.classList.add('invert'); message.classList.add('invert-text');
      showMessage(`+${label}\nPENALTY`);
      restartAnimations(display, message);
      closePenModal();
    });
    penGridTime.appendChild(b);
  });
  // 1 minute
  {
    const b=document.createElement('button');
    b.className='chip'; b.textContent='1min';
    b.addEventListener('click', ()=>{
      clearFlags();
      display.classList.add('invert'); message.classList.add('invert-text');
      showMessage(`+1min\nPENALTY`);
      restartAnimations(display, message);
      closePenModal();
    });
    penGridTime.appendChild(b);
  }

  // Tours : 1 → 5  (message "+ X LAP(S)")
  for(let laps=1;laps<=5;laps++){
    const b=document.createElement('button');
    b.className='chip';
    b.textContent = laps === 1 ? '1 LAP' : `${laps} LAPS`;
    b.addEventListener('click', ()=>{
      clearFlags();
      display.classList.add('invert'); message.classList.add('invert-text');
      const unit = laps > 1 ? 'LAPS' : 'LAP';
      showMessage(`+ ${laps} ${unit}\nPENALTY`);
      restartAnimations(display, message);
      closePenModal();
    });
    penGridLap.appendChild(b);
  }

  penClose.addEventListener('click', closePenModal);
  penModal.addEventListener('click', e=>{ if(e.target===penModal) closePenModal(); });

  /* MENU */
  document.getElementById('menuToggle').addEventListener('click', e=>{
    e.preventDefault(); openMenu(!menu.classList.contains('open'));
  });

  /* Actions du menu */
  menu.addEventListener('click', (e)=>{
    const btn=e.target.closest('button'); if(!btn) return;
    const action=btn.dataset.action; const flag=btn.dataset.flag;

    if(action==='position'){ openPosModal(); return; }
    if(action==='penalty'){ openPenModal(); return; }
    hideWatermark();

    if(action==='box'){ clearFlags(); display.classList.add('invert'); message.classList.add('invert-text'); showMessage('BOX BOX'); restartAnimations(display, message); openMenu(false); return; }
    if(action==='rpm'){ clearFlags(); display.classList.add('invert'); message.classList.add('invert-text'); showMessage('7000+'); restartAnimations(display, message); openMenu(false); return; }
    if(action==='focus'){ clearFlags(); display.classList.add('invert'); message.classList.add('invert-text'); showMessage('FOCUS'); restartAnimations(display, message); openMenu(false); return; }
    if(action==='fcy'){ clearFlags(); display.classList.add('fcy'); message.classList.add('fcy-text'); showMessage('FCY'); restartAnimations(display, message); openMenu(false); return; }
    if(action==='lastlap'){ clearFlags(); display.classList.add('lastlap'); message.classList.add('lastlap-text'); showMessage("LAST\nLAP"); restartAnimations(display, message); openMenu(false); return; }
    if(action==='reset'){ showWatermark(); clearFlags(); clearMessage(); openMenu(false); return; }

    if(flag){
      clearFlags(); clearMessage();
      if(flag==='green') display.classList.add('green-flash');
      else if(flag==='yellow') display.classList.add('yellow-swap');
      else if(flag==='checkered') display.classList.add('bg-checkered');
      else if(flag==='blue') display.classList.add('blue-flash');
      restartAnimations(display);
      openMenu(false);
    }
  });

  /* Tap écran: retour au noir + watermark */
  display.addEventListener('click', ()=>{ showWatermark(); clearFlags(); clearMessage(); });
</script>
</body>
</html>
